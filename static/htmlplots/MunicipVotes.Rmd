---
title: "Japanese General Elections"
#subtitle: "Exploratory Analysis"
author: "Populism in Regional Japan: Where is the 'Revenge of the Places That Don't Matter'?"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  rmdformats::readthedown:
    toc_depth: 3
---


```{r results='hide', echo=FALSE, include=FALSE}
p_needed <- c("tidyverse",
              "here",
              "readxl",
              "data.table",
              "magrittr",
              "rvest",
              "htmltab",
              "xml2",
              "gt",
              "lme4",
              "gtsummary",
              "gtExtras",
              "crosstable",
              "rmdformats",
              "ggcorrplot",
              "texreg",
              "plm",
              "sf",
              "spdep",
              "ggthemes",
              "ggpubr",
              "ggrepel",
              "splm",
              "spatialreg",
              "viridis"
)
packages <- rownames(installed.packages())
p_to_install <- p_needed[!(p_needed %in% packages)]
if (length(p_to_install) > 0) {
  install.packages(p_to_install)
}
lapply(p_needed, require, character.only = TRUE)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
Elections <- read_csv(here("static", "htmlplots", "Data", "Elections2.csv"), col_names = TRUE)
```

```{r echo=FALSE}

# Elections <- Elections[,-c(5,8)]
Elections[, 5:7][Elections[, 5:7] == 0] <- NA

Elections2 <- Elections %>%
  filter(LDP>=0 | LDP %in% NA) %>%
  filter(LDP <=1 | LDP %in% NA) %>%
  filter(JCP>=0 | JCP %in% NA) %>%
  filter(JCP <=1 | JCP %in% NA)

Elections2$Year <- as.character(Elections2$Year)
Elections2$Year <- as.factor(Elections2$Year)

Elections2$Code <- as.character(Elections2$Code)
Elections2$Code <- as.factor(Elections2$Code)

Elections2 <- Elections2 %>%
  filter(!Code %in% NA) %>%
  mutate(Turnout = ifelse(Turnout >=1, NA, Turnout),
         EldPop = EldPop/100)

Elections3 <- Elections2[!duplicated(Elections2[,1:2]),]

Elections4 <- Elections3 %>%
  group_by(kuname) %>%
  filter(all(c("全部過疎", "Normal") %in% Kaso))

Elections5 <- Elections3 %>%
  group_by(kuname) %>%
  filter(all(c("全部過疎", "Normal", "一部過疎") %in% Kaso))

# https://stackoverflow.com/a/58207744
```



```{r echo=FALSE}
my_pal <- scales::col_numeric(
  paletteer::paletteer_d(
    palette = "ggsci::red_material"
    ) %>% as.character(),
  domain = NULL
  )

```

# Exploratory tables

## Basic differences between "merged" and "non-merged"

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections3 %>%
  mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
                      labels = c("Non-Merged", "Merged"))) %>%
  group_by(Year, Fusion) %>%
  dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                   `LDP-SMD-relative` = mean(LDP_relative, na.rm=TRUE),
                   `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                   `LDP-PR-relative` = mean(LDPPR_relative, na.rm=TRUE),
                   `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                   `LDP-Gap-relative` = mean(LDPDif_relative, na.rm=TRUE),
                   Turnout = mean(Turnout, na.rm=TRUE),
                   `Turnout-relative` = mean(Turnout_relative, na.rm=TRUE),
                   FStrength = mean(Fstrength, na.rm=TRUE),
                   LATperCapita = mean(LATperCapita, na.rm=TRUE),
                   Elderly = mean(EldPop, na.rm=TRUE)
                   #SCapital = mean(social_capital, na.rm=TRUE)
                   ) %>%
  gt(rowname_col = "Fusion") %>%
  fmt_number(
    columns = 2:13,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = c(Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
  ) %>%
    data_color(
    columns = 2:13,
    colors = my_pal
    )
#   gtsave(
#     "merged.png"
# )
```

<br><br>

## Fiscal differences

### Merged / non-merged counts and proportions across kaso-types 

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE, include=FALSE}
Elections3 %>%
  select(Year, Fusion, Kaso) %>%
  mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
                      labels = c("Non-Merged", "Merged"))) %>%
  tbl_summary(
    by = Year, # split table by group
    missing = "no" # don't list missing data separately
  ) %>%
  add_overall() %>%
  modify_header(label = "**Variable**") %>% # update the column header
  bold_labels() 
```

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections3 %>%
  filter(Year %in% 2009,
         Kaso %in% c("Normal", "みなし過疎", 
                     "一部過疎", "全部過疎")) %>%
  select(Year, Fusion, Kaso) %>%
  mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
                      labels = c("Non-Merged", "Merged"))) %>%
  tbl_cross(
    row = Fusion,
    col = Kaso,
    percent = "column",
    label = list(Kaso ~ "2009", Fusion ~ "Fusion")
  )

Elections3 %>%
  filter(Year %in% 2012) %>%
  select(Year, Fusion, Kaso) %>%
  mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
                      labels = c("Non-Merged", "Merged"))) %>%
  tbl_cross(
    row = Fusion,
    col = Kaso,
    percent = "column",
    label = list(Kaso ~ "2012", Fusion ~ "Fusion")
  )

Elections3 %>%
  filter(Year %in% 2014) %>%
  select(Year, Fusion, Kaso) %>%
  mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
                      labels = c("Non-Merged", "Merged"))) %>%
  tbl_cross(
    row = Fusion,
    col = Kaso,
    percent = "column",
    label = list(Kaso ~ "2014", Fusion ~ "Fusion")
  )

Elections3 %>%
  filter(Year %in% 2017) %>%
  select(Year, Fusion, Kaso) %>%
  mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
                      labels = c("Non-Merged", "Merged"))) %>%
  tbl_cross(
    row = Fusion,
    col = Kaso,
    percent = "column",
    label = list(Kaso ~ "2017", Fusion ~ "Fusion")
  )

Elections3 %>%
  filter(Year %in% 2021) %>%
  select(Year, Fusion, Kaso) %>%
  mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
                      labels = c("Non-Merged", "Merged"))) %>%
  tbl_cross(
    row = Fusion,
    col = Kaso,
    percent = "column",
    label = list(Kaso ~ "2021", Fusion ~ "Fusion")
  )
```

```{r include=FALSE}
# Elections3 %>%
#   select(Year, Fusion, Kaso) %>%
#   mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
#                       labels = c("Non-Merged", "Merged"))) %>%
#   crosstable(c(Fusion, Kaso), by=Year, total="both") %>%
#   as_flextable(keep_id=FALSE)
```



### Basic differences between "Normal" and "Kaso" 

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections3 %>%
  filter(Kaso2 %in% c("Kaso", "Normal")) %>%
  group_by(Year, Kaso2) %>%
  dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                   `LDP-SMD-relative` = mean(LDP_relative, na.rm=TRUE),
                   `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                   `LDP-PR-relative` = mean(LDPPR_relative, na.rm=TRUE),
                   `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                   `LDP-Gap-relative` = mean(LDPDif_relative, na.rm=TRUE),
                   Turnout = mean(Turnout, na.rm=TRUE),
                   `Turnout-relative` = mean(Turnout_relative, na.rm=TRUE), 
                   FStrength = mean(Fstrength, na.rm=TRUE),
                   LATperCapita = mean(LATperCapita, na.rm=TRUE),
                   Elderly = mean(EldPop, na.rm=TRUE)
                   #SCapital = mean(social_capital, na.rm=TRUE)
                   ) %>%
  gt(rowname_col = "Kaso2") %>%
  fmt_number(
    columns = 2:13,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = c(Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:13,
    colors = my_pal
    )
#   gtsave(
#     "kaso-nonkaso-unique.png"
# )
```


<!-- ### Basic differences between "Normal" and "Kaso" + Merged/Non-Merged -->

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE, include=FALSE}
Elections3 %>%
  group_by(Year, Kaso2.fusion) %>%
  dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-PR-relative` = mean(LDPPR_relative, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     LATperCapita = mean(LATperCapita, na.rm=TRUE), 
                     Elderly = mean(EldPop, na.rm=TRUE)
                     #SCapital = mean(social_capital, na.rm=TRUE)
                   ) %>%
  gt(rowname_col = "Kaso2.fusion") %>%
  fmt_number(
    columns = 2:13,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = c(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:13,
    colors = my_pal
    )
```


<br><br>

### Detailed differences (including types of "Kaso")

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections3 %>%
  filter(Kaso %in% c("Normal", "みなし過疎", 
                     "一部過疎", "全部過疎")) %>%
  group_by(Year, Kaso) %>%
  dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                   `LDP-SMD-relative` = mean(LDP_relative, na.rm=TRUE),
                   `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                   `LDP-PR-relative` = mean(LDPPR_relative, na.rm=TRUE),
                   `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                   `LDP-Gap-relative` = mean(LDPDif_relative, na.rm=TRUE),
                   Turnout = mean(Turnout, na.rm=TRUE),
                   `Turnout-relative` = mean(Turnout_relative, na.rm=TRUE),
                   FStrength = mean(Fstrength, na.rm=TRUE),
                   LATperCapita = mean(LATperCapita, na.rm=TRUE),
                   Elderly = mean(EldPop, na.rm=TRUE)
                   #SCapital = mean(social_capital, na.rm=TRUE)
                   ) %>%
  gt(rowname_col = "Kaso") %>%
  fmt_number(
    columns = 2:13,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = c(Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:13,
    colors = my_pal
    )
#   gtsave(
#     "kaso-detailed-unique.png"
# )
```



<br><br>

### Detailed differences (including types of "Kaso") + Merged/Non-Merged

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections3 %>%
  filter(Kaso %in% c("Normal", "みなし過疎", 
                     "一部過疎", "全部過疎", "全部過疎-Merged")) %>%
  group_by(Year, Kaso.fusion) %>%
  dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                   `LDP-SMD-relative` = mean(LDP_relative, na.rm=TRUE),
                   `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                   `LDP-PR-relative` = mean(LDPPR_relative, na.rm=TRUE),
                   `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                   `LDP-Gap-relative` = mean(LDPDif_relative, na.rm=TRUE),
                   Turnout = mean(Turnout, na.rm=TRUE),
                   `Turnout-relative` = mean(Turnout_relative, na.rm = TRUE),
                   FStrength = mean(Fstrength, na.rm=TRUE),
                   LATperCapita = mean(LATperCapita, na.rm=TRUE),
                   Elderly = mean(EldPop, na.rm=TRUE),
                   #SCapital = mean(social_capital, na.rm=TRUE)
                   ) %>%
  gt(rowname_col = "Kaso.fusion") %>%
  fmt_number(
    columns = 2:13,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = c(Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:13,
    colors = my_pal
    )
#   gtsave(
#     "kaso-merged-detailed-unique.png"
# )
```

<br><br>

## 2009 -- 2021 trends

### Basic differences between "Normal" and "Kaso"

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections3 %>%
  filter(Kaso2 %in% c("Kaso", "Normal")) %>%
  group_by(Kaso2) %>%
  dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                   `LDP-SMD-relative` = mean(LDP_relative, na.rm=TRUE),
                   `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                   `LDP-PR-relative` = mean(LDPPR_relative, na.rm=TRUE),
                   `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                   `LDP-Gap-relative` = mean(LDPDif_relative, na.rm=TRUE),
                   Turnout = mean(Turnout, na.rm=TRUE),
                   `Turnout-relative` = mean(Turnout_relative, na.rm=TRUE),
                   FStrength = mean(Fstrength, na.rm=TRUE),
                   LATperCapita = mean(LATperCapita, na.rm=TRUE),
                   Elderly = mean(EldPop, na.rm=TRUE)
                   #SCapital = mean(social_capital, na.rm=TRUE)
                   ) %>%
  gt(rowname_col = "Kaso2") %>%
  fmt_number(
    columns = 2:12,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = c(Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:12,
    colors = my_pal
    )
#   gtsave(
#     "kaso-nonkaso-overall.png"
# )
```

### Detailed differences (including types of "Kaso") + Merged/Non-Merged

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections3 %>%
  filter(Kaso %in% c("Normal", "みなし過疎", 
                     "一部過疎", "全部過疎", "全部過疎-Merged")) %>%
  group_by(Kaso.fusion) %>%
  dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                   `LDP-SMD-relative` = mean(LDP_relative, na.rm=TRUE),
                   `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                   `LDP-PR-relative` = mean(LDPPR_relative, na.rm=TRUE),
                   `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                   `LDP-Gap-relative` = mean(LDPDif_relative, na.rm=TRUE),
                   Turnout = mean(Turnout, na.rm=TRUE),
                   `Turnout-relative` = mean(Turnout_relative, na.rm=TRUE),
                   FStrength = mean(Fstrength, na.rm=TRUE),
                   LATperCapita = mean(LATperCapita, na.rm=TRUE),
                   Elderly = mean(EldPop, na.rm=TRUE)
                   #SCapital = mean(social_capital, na.rm=TRUE)
                   ) %>%
  gt(rowname_col = "Kaso.fusion") %>%
  fmt_number(
    columns = 2:12,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = c(Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:12,
    colors = my_pal
    ) 
#   gtsave(
#     "kaso-merged-detailed-overall.png"
# )
```


# Statistical analysis

## Summary statistics

```{r echo=FALSE, results='asis'}
Elections3[,-c(23:28)] %>%
  # Keep numeric variables
  select_if(is.numeric) %>%
  # gather variables
  gather(Variable, value) %>%
  # Summarize by variable
  group_by(Variable) %>%
  # summarise all columns
  summarise(n = sum(!is.na(value)),
            `Mean` = mean(value, na.rm = TRUE),
            `Std. Dev.` = sd(value, na.rm = TRUE),
            `Median` = median(value, na.rm = TRUE),
            `Min.` = min(value, na.rm = TRUE),
            `Max.` = max(value, na.rm = TRUE)) %>%
  gt() %>%
  fmt_number(
    columns = 3:7,
    decimals = 2) %>%
  fmt_number(
    rows = 4,
    columns = 3:7,
    decimals = 0) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Summary statistics**"))

```


## Correlation matrix

```{r echo=FALSE, results='asis'}
Elections3[,-c(6,11,13:15,18:20,22:30)] %>%
  select_if(is.numeric) %>%
  cor(use = "complete.obs") %>% 
  ggcorrplot(hc.order = TRUE, #hierarchical ordering
             type = "lower",
             lab = TRUE,
             lab_size = 4,
             outline.color = "white",
             colors = c("#6D9EC1", "white", "#E46726"),
             sig.level=0.05,
             insig = "blank") +
  theme(plot.background = element_rect(fill = "#303030", color = "#303030"),
        axis.text.x = element_text(colour = "grey", family = "serif", size = 15),
        axis.text.y = element_text(colour = "grey",family = "serif", size = 15),
        legend.title = element_text(color = "white"),
        legend.text = element_text(color = "white"),
        plot.title = element_text(hjust = 0.5, color = "white", face="bold"))
```

## Regressions

### Turnout ratio

```{r echo=FALSE, include=FALSE}
TurnoutMod1 <- plm(Turnout ~ Year + Fstrength, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

TurnoutMod2 <- plm(Turnout ~ Year + Fstrength + EldPop + LDP,
                   index=c("Code","Year"),
                   model = "pooling", data = Elections3)

TurnoutMod3 <- plm(Turnout ~ Year + Fstrength + EldPop + LDP + 
                   Kaso.fusion, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

#sqrt(car::vif(TurnoutMod3))
```


```{r echo=FALSE, include=FALSE}
TurnoutMod4 <- plm(Turnout_relative ~ Year + Fstrength, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

TurnoutMod5 <- plm(Turnout_relative ~ Year + Fstrength + EldPop + LDP,
                   index=c("Code","Year"),
                   model = "pooling", data = Elections3)

TurnoutMod6 <- plm(Turnout_relative ~ Year + Fstrength + EldPop + LDP + 
                   Kaso.fusion, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

#sqrt(car::vif(TurnoutMod6))
```


```{r echo=FALSE, include=FALSE}
turnout.pooled <- plm(Turnout ~ Fstrength + LDP + Kaso.fusion + EldPop,
                  index=c("Code","Year"), data = Elections3, model = "within", effect = "time")

turnout.fe <- plm(Turnout ~ Year + Fstrength + LDP + Kaso.fusion + EldPop,
                  index=c("Code","Year"), data = Elections3, model = "within")

turnout.re <- plm(Turnout ~ Fstrength + LDP + Kaso.fusion + EldPop,
                  index=c("Code","Year"), data = Elections3, 
                  model = "random")
```


#### Absolute values

```{r turnout, results='asis', echo=FALSE}
htmlreg(list(TurnoutMod1, TurnoutMod2, TurnoutMod3),
       custom.model.names = c("Model 1", "Model 2", "Model 3"),
       custom.coef.names = c("(Intercept)", "2012",
                             "2014", "2017", "2021", "Fiscal Strength",
                             "Elderly", "LDP", "みなし過疎",
                             "一部過疎", "全部過疎", "全部過疎-Merged"),
       groups = list("Year dummy (base group = '2009')" = 2:5,
         "Fiscal type (base group = 'Normal')" = 9:12),
       caption = NULL,
       digits = 2,
#       reorder.coef = c(2:8,1),
       include.ercomp = FALSE,
       single.row = FALSE,
       booktabs = TRUE,
       dcolumn = TRUE,
       caption.above = TRUE,
       threeparttable = TRUE,
       use.packages = FALSE,
       stars = c(0.01, 0.05, 0.1),
       label = "tab:Turnout"
       )
```


<br>

#### Values relative to SMD-average

```{r turnout2, results='asis', echo=FALSE}
htmlreg(list(TurnoutMod4, TurnoutMod5, TurnoutMod6),
       custom.model.names = c("Model 1", "Model 2", "Model 3"),
       custom.coef.names = c("(Intercept)", "2012",
                             "2014", "2017", "2021", "Fiscal Strength",
                             "Elderly", "LDP", "みなし過疎",
                             "一部過疎", "全部過疎", "全部過疎-Merged"),
       groups = list("Year dummy (base group = '2009')" = 2:5,
         "Fiscal type (base group = 'Normal')" = 9:12),
       caption = NULL,
       digits = 2,
#       reorder.coef = c(2:8,1),
       include.ercomp = FALSE,
       single.row = FALSE,
       booktabs = TRUE,
       dcolumn = TRUE,
       caption.above = TRUE,
       threeparttable = TRUE,
       use.packages = FALSE,
       stars = c(0.01, 0.05, 0.1),
       label = "tab:Turnout2"
       )
```

<br><br>

### LDP: SMD-Votes

```{r echo=FALSE, include=FALSE}
LDPMod1 <- plm(LDP ~ Year + Fstrength, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

LDPMod2 <- plm(LDP ~ Year + Fstrength + EldPop + Turnout, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

LDPMod3 <- plm(LDP ~ Year + Fstrength + EldPop + Turnout + 
                   Kaso.fusion, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

#sqrt(car::vif(LDPMod6))
```

```{r echo=FALSE, include=FALSE}
LDPMod4 <- plm(LDP_relative ~ Year + Fstrength, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

LDPMod5 <- plm(LDP_relative ~ Year + Fstrength + EldPop + Turnout, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

LDPMod6 <- plm(LDP_relative ~ Year + Fstrength + EldPop + Turnout + 
                   Kaso.fusion, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

#sqrt(car::vif(LDPMod6))
```


```{r echo=FALSE, include=FALSE}
ldp.pooled <- plm(LDP ~ Fstrength + Turnout + Kaso.fusion + EldPop,
                  index=c("Code","Year"), data = Elections3, model = "within", effect = "time")

ldp.fe <- plm(LDP ~ Fstrength + Turnout + Kaso.fusion + EldPop,
                  index=c("Code","Year"), data = Elections3, model = "within")

ldp.re <- plm(LDP ~ Fstrength + Turnout + Kaso.fusion + EldPop,
                  index=c("Code","Year"), data = Elections3, 
                  model = "random")
```


#### Absolute values

```{r ldp, results='asis', echo=FALSE}
htmlreg(list(LDPMod1, LDPMod2, LDPMod3),
       custom.model.names = c("Model 1", "Model 2", "Model 3"),
       custom.coef.names = c("(Intercept)", "2012",
                             "2014", "2017", "2021", "Fiscal Strength",
                             "Elderly", "Turnout", "みなし過疎",
                             "一部過疎", "全部過疎", "全部過疎-Merged"),
       groups = list("Year dummy (base group = '2009')" = 2:5,
         "Fiscal type (base group = 'Normal')" = 9:12),
       caption = NULL,
       digits = 2,
#       reorder.coef = c(2:8,1),
       include.ercomp = FALSE,
       single.row = FALSE,
       booktabs = TRUE,
       dcolumn = TRUE,
       caption.above = TRUE,
       threeparttable = TRUE,
       use.packages = FALSE,
       stars = c(0.01, 0.05, 0.1),
       label = "tab:LDP"
       )
```


<br>

#### Values relative to SMD-average

```{r ldp2, results='asis', echo=FALSE}
htmlreg(list(LDPMod4, LDPMod5, LDPMod6),
       custom.model.names = c("Model 1", "Model 2", "Model 3"),
       custom.coef.names = c("(Intercept)", "2012",
                             "2014", "2017", "2021", "Fiscal Strength",
                             "Elderly", "Turnout", "みなし過疎",
                             "一部過疎", "全部過疎", "全部過疎-Merged"),
       groups = list("Year dummy (base group = '2009')" = 2:5,
         "Fiscal type (base group = 'Normal')" = 9:12),
       caption = NULL,
       digits = 2,
#       reorder.coef = c(2:8,1),Absolute
       include.ercomp = FALSE,
       single.row = FALSE,
       booktabs = TRUE,
       dcolumn = TRUE,
       caption.above = TRUE,
       threeparttable = TRUE,
       use.packages = FALSE,
       stars = c(0.01, 0.05, 0.1),
       label = "tab:LDP2"
       )
```

<br><br>

### LDP: SMD-PR Difference

```{r echo=FALSE, include=FALSE}
LDPDifMod1 <- plm(LDPDif ~ Year + Fstrength, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

LDPDifMod2 <- plm(LDPDif ~ Year + Fstrength + EldPop + Turnout, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

LDPDifMod3 <- plm(LDPDif ~ Year + Fstrength + EldPop + Turnout + 
                   Kaso.fusion, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

#sqrt(car::vif(LDPMod3))
```

```{r echo=FALSE, include=FALSE}
LDPDifMod4 <- plm(LDPDif_relative ~ Year + Fstrength, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

LDPDifMod5 <- plm(LDPDif_relative ~ Year + Fstrength + EldPop + Turnout, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

LDPDifMod6 <- plm(LDPDif_relative ~ Year + Fstrength + EldPop + Turnout + 
                   Kaso.fusion, index=c("Code","Year"),
                   model = "pooling", data = Elections3)

#sqrt(car::vif(LDPMod3))
```


#### Absolute values

```{r ldpdif, results='asis', echo=FALSE}
htmlreg(list(LDPDifMod1, LDPDifMod2, LDPDifMod3),
       custom.model.names = c("Model 1", "Model 2", "Model 3"),
       custom.coef.names = c("(Intercept)", "2012",
                             "2014", "2017", "2021", "Fiscal Strength",
                             "Elderly", "Turnout", "みなし過疎",
                             "一部過疎", "全部過疎", "全部過疎-Merged"),
       groups = list("Year dummy (base group = '2009')" = 2:5,
         "Fiscal type (base group = 'Normal')" = 9:12),
       caption = NULL,
       digits = 2,
#       reorder.coef = c(2:8,1),
       include.ercomp = FALSE,
       single.row = FALSE,
       booktabs = TRUE,
       dcolumn = TRUE,
       caption.above = TRUE,
       threeparttable = TRUE,
       use.packages = FALSE,
       stars = c(0.01, 0.05, 0.1),
       label = "tab:LDPDif"
       )
```


<br>

#### Values relative to SMD-average

```{r ldpdif2, results='asis', echo=FALSE}
htmlreg(list(LDPDifMod4, LDPDifMod5, LDPDifMod6),
       custom.model.names = c("Model 1", "Model 2", "Model 3"),
       custom.coef.names = c("(Intercept)", "2012",
                             "2014", "2017", "2021", "Fiscal Strength",
                             "Elderly", "Turnout", "みなし過疎",
                             "一部過疎", "全部過疎", "全部過疎-Merged"),
       groups = list("Year dummy (base group = '2009')" = 2:5,
         "Fiscal type (base group = 'Normal')" = 9:12),
       caption = NULL,
       digits = 2,
#       reorder.coef = c(2:8,1),
       include.ercomp = FALSE,
       single.row = FALSE,
       booktabs = TRUE,
       dcolumn = TRUE,
       caption.above = TRUE,
       threeparttable = TRUE,
       use.packages = FALSE,
       stars = c(0.01, 0.05, 0.1),
       label = "tab:LDPDif2"
       )
```


<br><br>
