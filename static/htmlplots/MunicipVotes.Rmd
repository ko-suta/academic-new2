---
title: "Japanese General Elections"
subtitle: "Exploratory Analysis"
author: "Populism in Regional Japan: Where is the 'Revenge of the Places That Don't Matter'?"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  rmdformats::readthedown:
    toc_depth: 3
---


```{r results='hide', echo=FALSE, include=FALSE}
p_needed <- c("tidyverse",
              "here",
              "readxl",
              "data.table",
              "magrittr",
              "rvest",
              "htmltab",
              "xml2",
              "gt",
              "gtExtras",
              "rmdformats"
)
packages <- rownames(installed.packages())
p_to_install <- p_needed[!(p_needed %in% packages)]
if (length(p_to_install) > 0) {
  install.packages(p_to_install)
}
lapply(p_needed, require, character.only = TRUE)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
Elections <- read_csv(here("static", "htmlplots", "Data", "Elections.csv"), col_names = TRUE)
```



```{r echo=FALSE}
my_pal <- scales::col_numeric(
  paletteer::paletteer_d(
    palette = "ggsci::red_material"
    ) %>% as.character(),
  domain = NULL
  )

```

<br><br>

## Basic differences between "merged" and "non-merged"

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections %>%
  mutate(Fusion = factor(Fusion, levels = c("0", "1"), 
                      labels = c("Non-Merged", "Merged"))) %>%
  group_by(Year, Fusion) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Fusion") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```

<br><br>

## 2021 "Kaso" values

### Basic differences between "Normal" and "Kaso" 

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections %>%
  group_by(Year, Kaso2.x) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Kaso2.x") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```


<!-- ### Basic differences between "Normal" and "Kaso" + Merged/Non-Merged -->

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE, include=FALSE}
Elections %>%
  group_by(Year, Kaso2.x.fusion) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Kaso2.x.fusion") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```

<br><br>

### Detailed differences (including types of "Kaso")

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections %>%
  group_by(Year, Kaso.x) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Kaso.x") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```

<br><br>

### Detailed differences (including types of "Kaso") + Merged/Non-Merged

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections %>%
  group_by(Year, Kaso.x.fusion) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Kaso.x.fusion") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```

<br><br>

## Year-specific "Kaso" values

### Basic differences between "Normal" and "Kaso" 

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections %>%
  group_by(Year, Kaso2.y) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Kaso2.y") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```


<!-- ### Basic differences between "Normal" and "Kaso" + Merged/Non-Merged -->

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE, include=FALSE}
Elections %>%
  group_by(Year, Kaso2.y.fusion) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Kaso2.y.fusion") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```


<br><br>

### Detailed differences (including types of "Kaso")

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections %>%
  group_by(Year, Kaso.y) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Kaso.y") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```



<br><br>

### Detailed differences (including types of "Kaso") + Merged/Non-Merged

```{r echo=FALSE, results='asis', message=FALSE, warning=FALSE}
Elections %>%
  group_by(Year, Kaso.y.fusion) %>%
  filter(LDP>=0 & LDP <=1) %>%
  filter(JCP>=0 & JCP <=1) %>%
  mutate(EldPop = EldPop/100) %>%
    dplyr::summarize(`LDP-SMD` = mean(LDP, na.rm=TRUE),
                     `LDP-PR` = mean(LDPPR, na.rm=TRUE),
                     `LDP-Gap` = mean(LDPDif, na.rm=TRUE),
                     `JCP-SMD` = mean(JCP, na.rm=TRUE),
                     `JCP-PR` = mean(JCPPR, na.rm=TRUE),
                     `JCP-Gap` = mean(JCPDif, na.rm=TRUE),
                     Turnout = mean(Turnout, na.rm=TRUE),
                     FStrength = mean(Fstrength, na.rm=TRUE),
                     Elderly = mean(EldPop, na.rm=TRUE)) %>%
  gt(rowname_col = "Kaso.y.fusion") %>%
  fmt_number(
    columns = 2:11,
    decimals = 3 # decrease decimal places
    ) %>%
  tab_style(
    style = list(
      cell_borders(
        sides = "left",
        color = "black",
        weight = px(3)
      )
    ),
    locations = list(
      cells_body(
        columns = vars(`JCP-SMD`, Turnout)
      ))) %>%
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
    ) %>%
  tab_header(
    title = md("**Municipal characteristics**"),
    subtitle = md("*Aggregated by fiscal profiles*")
  ) %>%
    data_color(
    columns = 2:11,
    colors = my_pal
    )
```

<br><br>